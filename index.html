<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra số nguyên tố lớn (chia 6 chữ số)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1 { text-align: center; color: #343a40; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .input-group {
            margin: 20px 0;
            display: flex;
            align-items: center;
        }
        label {
            width: 130px;
            font-weight: bold;
            font-size: 18px;
        }
        input {
            width: 200px;
            padding: 12px;
            font-size: 20px;
            font-family: monospace;
            text-align: center;
            letter-spacing: 4px;
        }
        button {
            padding: 14px 30px;
            font-size: 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 30px auto;
            display: block;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        #fullNumber {
            font-size: 28px;
            font-family: monospace;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            word-break: break-all;
        }
        #result {
            margin-top: 30px;
            font-size: 22px;
            line-height: 2;
            text-align: center;
        }
        .prime { color: #28a745; font-weight: bold; }
        .not-prime { color: #dc3545; font-weight: bold; }
        .divisor { color: #dc3545; font-size: 24px; }
        .estimate { color: #856404; background: #fff3cd; padding: 10px; border-radius: 6px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kiểm tra số nguyên tố lớn<br><small>(Nhập theo từng đoạn 6 chữ số)</small></h1>
        <div class="input-group">
            <label>Phần 1:</label>
            <input type="text" id="part1" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 2:</label>
            <input type="text" id="part2" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 3:</label>
            <input type="text" id="part3" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 4:</label>
            <input type="text" id="part4" maxlength="6" placeholder="000000">
        </div>
        <div id="fullNumber"></div>
        <button id="btn" onclick="kiemTra()">Kiểm tra số nguyên tố</button>
        <div id="result"></div>
    </div>
   <script>
/* ---------- UI ---------- */
const inputs = ['part1', 'part2', 'part3', 'part4'];
inputs.forEach(id => {
    document.getElementById(id).addEventListener('input', updateFullNumber);
});
function updateFullNumber() {
    let full = inputs.map(id => {
        let val = document.getElementById(id).value.replace(/\D/g, '');
        return val.padStart(6, '0').slice(-6);
    }).join('');
    full = full.replace(/^0+/, '');
    if (full === '') full = '0';
    document.getElementById('fullNumber').textContent = full;
}
/* ---------- Ước tính thời gian ---------- */
function estimateTime(digits) {
    if (digits <= 12) return "dưới 1 giây";
    const iterations = Math.pow(10, digits / 2) * (8 / 30);
    const seconds = Math.floor(iterations / 7000000) + 1;

    if (seconds < 60) return `${seconds} giây`;
    if (seconds < 3600) return `${Math.floor(seconds / 60)} phút`;
    if (seconds < 86400) return `${Math.floor(seconds / 3600)} giờ`;
    return `${Math.floor(seconds / 86400)} ngày hoặc hơn`;
}
/* ---------- sqrt BigInt ---------- */
function sqrtBigInt(n) {
    if (n < 0n) return -1n;
    if (n < 2n) return n;
    let x0 = n, x1 = (x0 + 1n) >> 1n;
    while (x1 < x0) {
        x0 = x1;
        x1 = (x1 + n / x1) >> 1n;
    }
    return x0;
}
/* ---------- kiểm tra chính phương ---------- */
function isPerfectSquareHybrid(n) {
    if (typeof n === "number") {
        const s = Math.floor(Math.sqrt(n));
        return s * s === n;
    } else {
        const s = sqrtBigInt(n);
        return s * s === n;
    }
}
/* ---------- TRIAL DIVISION WHEEL 30 ---------- */
function trialDivisionWheel30(n) {
    /* ===== Number ===== */
    if (typeof n === "number") {
        if (n < 2) return 0;
        if (n === 2 || n === 3 || n === 5) return null;
        if (n % 2 === 0) return 2;
        if (n % 3 === 0) return 3;
        if (n % 5 === 0) return 5;
        for (let d = 7; d * d <= n; d += 30) {
            if (n % d === 0) return d;
            if (n % (d + 4) === 0) return d + 4;
            if (n % (d + 6) === 0) return d + 6;
            if (n % (d + 10) === 0) return d + 10;
            if (n % (d + 12) === 0) return d + 12;
            if (n % (d + 16) === 0) return d + 16;
            if (n % (d + 22) === 0) return d + 22;
            if (n % (d + 24) === 0) return d + 24;
        }
        return null;
    }
    /* ===== BigInt ===== */
    if (n < 2n) return 0n;
    if (n === 2n || n === 3n || n === 5n) return null;
    if (n % 2n === 0n) return 2n;
    if (n % 3n === 0n) return 3n;
    if (n % 5n === 0n) return 5n;
    for (let d = 7n; d * d <= n; d += 30n) {
        if (n % d === 0n) return d;
        if (n % (d + 4n) === 0n) return d + 4n;
        if (n % (d + 6n) === 0n) return d + 6n;
        if (n % (d + 10n) === 0n) return d + 10n;
        if (n % (d + 12n) === 0n) return d + 12n;
        if (n % (d + 16n) === 0n) return d + 16n;
        if (n % (d + 22n) === 0n) return d + 22n;
        if (n % (d + 24n) === 0n) return d + 24n;
    }
    return null;
}
/* ---------- MAIN ---------- */
async function kiemTra() {
    const btn = document.getElementById('btn');
    btn.disabled = true;
    btn.textContent = "Đang kiểm tra...";
    try {
        let parts = inputs.map(id => {
            let val = document.getElementById(id).value.trim();
            if (!/^\d{0,6}$/.test(val)) {
                alert("Mỗi phần chỉ được nhập tối đa 6 chữ số!");
                return null;
            }
            return val.padStart(6, '0');
        });
        if (parts.includes(null)) {
            btn.disabled = false;
            btn.textContent = "Kiểm tra";
            return;
        }
        let fullStr = parts.join('').replace(/^0+/, '');
        if (fullStr === '') fullStr = '0';
        const digits = fullStr.length;
        let n;
        if (digits < 16) {
            n = Number(fullStr);
        } else {
            n = BigInt(fullStr);
        }
        document.getElementById('result').innerHTML = `
            <p>Số cần kiểm tra: <strong>${fullStr}</strong> (${digits} chữ số)</p>
            <div class="estimate">
                <strong>Thời gian xử lý ước tính:</strong> ${estimateTime(digits)}
            </div>
            <p>Đang kiểm tra...</p>
        `;
        await new Promise(r => setTimeout(r, 50));
        const t0 = performance.now();
        // XỬ LÝ ĐẶC BIỆT CHO CÁC SỐ NHỎ ĐỂ TRÁNH LỖI
        if (typeof n === "number") {
            if (n === 2 || n === 3 || n === 5) {
                const t1 = performance.now();
                const timeTaken = ((t1 - t0) / 1000).toFixed(2);
                document.getElementById('result').innerHTML += `
                    <p class="prime">→ Là số nguyên tố</p>
                    <p>Thời gian thực tế: ${timeTaken} giây</p>
                `;
                btn.disabled = false;
                btn.textContent = "Kiểm tra số nguyên tố";
                return;
            }
            if (n < 2 || n % 2 === 0 || n % 3 === 0 || n % 5 === 0) {
                let smallDivisor = n < 2 ? null : (n % 2 === 0 ? 2 : (n % 3 === 0 ? 3 : 5));
                const t1 = performance.now();
                const timeTaken = ((t1 - t0) / 1000).toFixed(2);
                document.getElementById('result').innerHTML += `
                    <p class="not-prime">→ Không phải số nguyên tố</p>
                    ${smallDivisor ? `<p class="divisor">Chia hết cho: ${smallDivisor}</p>` : ''}
                    <p>Thời gian thực tế: ${timeTaken} giây</p>
                `;
                btn.disabled = false;
                btn.textContent = "Kiểm tra số nguyên tố";
                return;
            }
        } else { // BigInt
            if (n === 2n || n === 3n || n === 5n) {
                const t1 = performance.now();
                const timeTaken = ((t1 - t0) / 1000).toFixed(2);
                document.getElementById('result').innerHTML += `
                    <p class="prime">→ Là số nguyên tố</p>
                    <p>Thời gian thực tế: ${timeTaken} giây</p>
                `;
                btn.disabled = false;
                btn.textContent = "Kiểm tra số nguyên tố";
                return;
            }
            if (n < 2n || n % 2n === 0n || n % 3n === 0n || n % 5n === 0n) {
                let smallDivisor = (n % 2n === 0n) ? 2n : (n % 3n === 0n ? 3n : 5n);
                const t1 = performance.now();
                const timeTaken = ((t1 - t0) / 1000).toFixed(2);
                document.getElementById('result').innerHTML += `
                    <p class="not-prime">→ Không phải số nguyên tố</p>
                    <p class="divisor">Chia hết cho: ${smallDivisor}</p>
                    <p>Thời gian thực tế: ${timeTaken} giây</p>
                `;
                btn.disabled = false;
                btn.textContent = "Kiểm tra số nguyên tố";
                return;
            }
        }
        const n1 = typeof n === "number" ? n + 1 : n + 1n;
        const n4 = typeof n === "number" ? n + 4 : n + 4n;
        if (isPerfectSquareHybrid(n)) {
            const t1 = performance.now();
            const timeTaken = ((t1 - t0) / 1000).toFixed(2);
            document.getElementById('result').innerHTML += `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p>(Là số chính phương)</p>
                <p>Thời gian thực tế: ${timeTaken} giây</p>
            `;
            btn.disabled = false;
            btn.textContent = "Kiểm tra số nguyên tố";
            return;
        }
        if (isPerfectSquareHybrid(n1)) {
            const t1 = performance.now();
            const timeTaken = ((t1 - t0) / 1000).toFixed(2);
            document.getElementById('result').innerHTML += `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p>(n+1 là số chính phương)</p>
                <p>Thời gian thực tế: ${timeTaken} giây</p>
            `;
            btn.disabled = false;
            btn.textContent = "Kiểm tra số nguyên tố";
            return;
        }
        if (isPerfectSquareHybrid(n4)) {
            const t1 = performance.now();
            const timeTaken = ((t1 - t0) / 1000).toFixed(2);
            document.getElementById('result').innerHTML += `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p>(n+4 là số chính phương)</p>
                <p>Thời gian thực tế: ${timeTaken} giây</p>
            `;
            btn.disabled = false;
            btn.textContent = "Kiểm tra số nguyên tố";
            return;
        }
        const divisor = trialDivisionWheel30(n);
        const t1 = performance.now();
        const timeTaken = ((t1 - t0) / 1000).toFixed(2);
        let html = '';
        if (divisor === null) {
            html = `<p class="prime">→ Là số nguyên tố</p>`;
        } else {
            html = `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p class="divisor">Chia hết cho: ${divisor}</p>
            `;
        }
        html += `<p>Thời gian thực tế: ${timeTaken} giây</p>`;
        document.getElementById('result').innerHTML += html;
    } catch (err) {
        console.error(err);
        document.getElementById('result').innerHTML += `
            <p style="color:red;">Lỗi không xác định: ${err.message || 'Unknown error'}</p>
        `;
    } finally {
        btn.disabled = false;
        btn.textContent = "Kiểm tra số nguyên tố";
    }
}
</script> 
</body>
</html>
