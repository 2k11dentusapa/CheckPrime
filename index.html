<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra số nguyên tố lớn (chia 6 chữ số)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1 { text-align: center; color: #343a40; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .input-group {
            margin: 20px 0;
            display: flex;
            align-items: center;
        }
        label {
            width: 130px;
            font-weight: bold;
            font-size: 18px;
        }
        input {
            width: 200px;
            padding: 12px;
            font-size: 20px;
            font-family: monospace;
            text-align: center;
            letter-spacing: 4px;
        }
        button {
            padding: 14px 30px;
            font-size: 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 30px auto;
            display: block;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        #fullNumber {
            font-size: 28px;
            font-family: monospace;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            word-break: break-all;
        }
        #result {
            margin-top: 30px;
            font-size: 22px;
            line-height: 2;
            text-align: center;
        }
        .prime { color: #28a745; font-weight: bold; }
        .not-prime { color: #dc3545; font-weight: bold; }
        .divisor { color: #dc3545; font-size: 24px; }
        .estimate { color: #856404; background: #fff3cd; padding: 10px; border-radius: 6px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kiểm tra số nguyên tố lớn<br><small>(Nhập theo từng đoạn 6 chữ số)</small></h1>

        <div class="input-group">
            <label>Phần 1:</label>
            <input type="text" id="part1" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 2:</label>
            <input type="text" id="part2" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 3:</label>
            <input type="text" id="part3" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 4:</label>
            <input type="text" id="part4" maxlength="6" placeholder="000000">
        </div>

        <div id="fullNumber"></div>

        <button id="btn" onclick="kiemTra()">Kiểm tra số nguyên tố</button>

        <div id="result"></div>
    </div>
<script>
/* ... (giữ nguyên tất cả các hàm cũ: updateFullNumber, estimateTime, sqrtBigInt, isPerfectSquareHybrid, trialDivisionWheel30) ... */

/* ---------- MAIN ---------- */
async function kiemTra() {
    const btn = document.getElementById('btn');
    btn.disabled = true;
    btn.textContent = "Đang kiểm tra...";

    try {
        let parts = inputs.map(id => {
            let val = document.getElementById(id).value.trim();
            if (!/^\d{0,6}$/.test(val)) {
                alert("Mỗi phần chỉ được nhập tối đa 6 chữ số!");
                return null;
            }
            return val.padStart(6, '0');
        });
        if (parts.includes(null)) return;

        let fullStr = parts.join('').replace(/^0+/, '');
        if (fullStr === '') fullStr = '0';
        const digits = fullStr.length;

        let n;
        if (digits < 16) {
            n = Number(fullStr);
        } else {
            n = BigInt(fullStr);
        }

        document.getElementById('result').innerHTML = `
            <p>Số cần kiểm tra: <strong>${fullStr}</strong> (${digits} chữ số)</p>
            <div class="estimate">
                <strong>Thời gian xử lý ước tính:</strong> ${estimateTime(digits)}
            </div>
            <p>Đang kiểm tra...</p>
        `;

        await new Promise(r => setTimeout(r, 50));

        const t0 = performance.now();

        /* ---- 1. LỌC CHÍNH PHƯƠNG TRƯỚC TIÊN (n, n+1, n+4) ---- */
        const n1 = typeof n === "number" ? n + 1 : n + 1n;
        const n4 = typeof n === "number" ? n + 4 : n + 4n;

        if (isPerfectSquareHybrid(n)) {
            const t1 = performance.now();
            const timeTaken = ((t1 - t0) / 1000).toFixed(2);
            document.getElementById('result').innerHTML += `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p>(Là số chính phương: √${fullStr} là số nguyên)</p>
                <p>Thời gian thực tế: ${timeTaken} giây</p>
            `;
            return;
        }

        if (isPerfectSquareHybrid(n1)) {
            const t1 = performance.now();
            const timeTaken = ((t1 - t0) / 1000).toFixed(2);
            document.getElementById('result').innerHTML += `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p>(n+1 là số chính phương: √${fullStr}+1 là số nguyên)</p>
                <p>Thời gian thực tế: ${timeTaken} giây</p>
            `;
            return;
        }

        if (isPerfectSquareHybrid(n4)) {
            const t1 = performance.now();
            const timeTaken = ((t1 - t0) / 1000).toFixed(2);
            document.getElementById('result').innerHTML += `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p>(n+4 là số chính phương: √${fullStr}+4 là số nguyên)</p>
                <p>Thời gian thực tế: ${timeTaken} giây</p>
            `;
            return;
        }

        /* ---- 2. Sau khi qua lọc chính phương mới chạy trial division ---- */
        const divisor = trialDivisionWheel30(n);

        const t1 = performance.now();
        const timeTaken = ((t1 - t0) / 1000).toFixed(2);

        let html = '';
        if (divisor === null) {
            html = `<p class="prime">→ Là số nguyên tố</p>`;
        } else if (divisor === 0 || divisor === 0n) {
            html = `<p class="not-prime">→ Không phải số nguyên tố (số nhỏ hơn 2)</p>`;
        } else {
            html = `
                <p class="not-prime">→ Không phải số nguyên tố</p>
                <p class="divisor">Chia hết cho: ${divisor}</p>
            `;
        }

        html += `<p>Thời gian thực tế: ${timeTaken} giây</p>`;
        document.getElementById('result').innerHTML += html;

    } catch (err) {
        console.error(err);
        document.getElementById('result').innerHTML += `<p style="color:red;">Lỗi không xác định!</p>`;
    } finally {
        btn.disabled = false;
        btn.textContent = "Kiểm tra số nguyên tố";
    }
}
</script>
</body>
<!-- Code được grok viết-->
</html>
