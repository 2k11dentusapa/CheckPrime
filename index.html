<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra số nguyên tố lớn (chia 6 chữ số)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1 { text-align: center; color: #343a40; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .input-group {
            margin: 20px 0;
            display: flex;
            align-items: center;
        }
        label {
            width: 130px;
            font-weight: bold;
            font-size: 18px;
        }
        input {
            width: 200px;
            padding: 12px;
            font-size: 20px;
            font-family: monospace;
            text-align: center;
            letter-spacing: 4px;
        }
        button {
            padding: 14px 30px;
            font-size: 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 30px auto;
            display: block;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        #fullNumber {
            font-size: 28px;
            font-family: monospace;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            word-break: break-all;
        }
        #result {
            margin-top: 30px;
            font-size: 22px;
            line-height: 2;
            text-align: center;
        }
        .prime { color: #28a745; font-weight: bold; }
        .not-prime { color: #dc3545; font-weight: bold; }
        .divisor { color: #dc3545; font-size: 24px; }
        .estimate { color: #856404; background: #fff3cd; padding: 10px; border-radius: 6px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kiểm tra số nguyên tố lớn<br><small>(Nhập theo từng đoạn 6 chữ số)</small></h1>

        <div class="input-group">
            <label>Phần 1:</label>
            <input type="text" id="part1" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 2:</label>
            <input type="text" id="part2" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 3:</label>
            <input type="text" id="part3" maxlength="6" placeholder="000000">
        </div>
        <div class="input-group">
            <label>Phần 4:</label>
            <input type="text" id="part4" maxlength="6" placeholder="000000">
        </div>

        <div id="fullNumber"></div>

        <button id="btn" onclick="kiemTra()">Kiểm tra số nguyên tố</button>

        <div id="result"></div>
    </div>
<script>
/* ---------- UI ---------- */
const inputs = ['part1', 'part2', 'part3', 'part4'];
inputs.forEach(id => {
    document.getElementById(id).addEventListener('input', updateFullNumber);
});

function updateFullNumber() {
    let full = inputs.map(id => {
        let val = document.getElementById(id).value.replace(/\D/g, '');
        return val.padStart(6, '0').slice(-6);
    }).join('');

    full = full.replace(/^0+/, '');
    if (full === '') full = '0';
    document.getElementById('fullNumber').textContent = full;
}

/* ---------- Ước tính thời gian (wheel 30, 7e6 vòng/s) ---------- */
function estimateTime(digits) {
    if (digits <= 12) return "dưới 1 giây";

    // Số phép thử ~ sqrt(n) * 8 / 30
    const iterations = Math.pow(10, digits / 2) * (8 / 30);
    const seconds = Math.floor(iterations / 7000000) + 1;

    if (seconds < 60) return `${seconds} giây`;
    if (seconds < 3600) return `${Math.floor(seconds / 60)} phút`;
    if (seconds < 86400) return `${Math.floor(seconds / 3600)} giờ`;
    return `${Math.floor(seconds / 86400)} ngày hoặc hơn`;
}
function sqrtBigInt(n) {
    if (n < 0n) return -1n;
    if (n < 2n) return n;
    let x0 = n, x1 = (x0 + 1n) >> 1n;
    while (x1 < x0) {
        x0 = x1;
        x1 = (x1 + n / x1) >> 1n;
    }
    return x0;
}

function isPerfectSquare(n) {
    const s = sqrtBigInt(n);
    return s * s === n;
}

/* ---------- Trial division: wheel 30 + lọc đúng ---------- */
function trialDivisionWithDivisor(n) {
    if (n < 2n) return 0n;
    if (n === 2n || n === 3n || n === 5n) return null;

    // Chia nhanh
    if (n % 2n === 0n) return 2n;
    if (n % 3n === 0n) return 3n;
    if (n % 5n === 0n) return 5n;

    // Lọc chính phương
    if (isPerfectSquare(n)) return sqrtBigInt(n);

    // Heuristic: loại hợp số, KHÔNG sinh ước giả
    if (isPerfectSquare(n + 1n)) return 0n;
    if (isPerfectSquare(n + 4n)) return 0n;

    // Lọc các prime nhỏ còn lại
    const small = [7n, 11n, 13n, 17n, 19n, 23n, 29n];
    for (const p of small) {
        if (n === p) return null;
        if (n % p === 0n) return p;
    }

    const sqrtN = sqrtBigInt(n);

    // 8 nhánh wheel 30 (dịch pha đúng)
    let d0 = 31n; // 30k + 1
    let d1 = 37n; // 30k + 7
    let d2 = 41n; // 30k + 11
    let d3 = 43n; // 30k + 13
    let d4 = 47n; // 30k + 17
    let d5 = 53n; // 30k + 23
    let d6 = 59n; // 30k + 29
    let d7 = 79n; // 30k + 19 (đúng điểm khởi động)

    while (true) {
        if (d0 > sqrtN) return null;

        if (n % d0 === 0n) return d0;
        if (n % d1 === 0n) return d1;
        if (n % d2 === 0n) return d2;
        if (n % d3 === 0n) return d3;
        if (n % d4 === 0n) return d4;
        if (n % d5 === 0n) return d5;
        if (n % d6 === 0n) return d6;
        if (n % d7 === 0n) return d7;

        d0 += 30n; d1 += 30n; d2 += 30n; d3 += 30n;
        d4 += 30n; d5 += 30n; d6 += 30n; d7 += 30n;
    }
}

/* ---------- Main ---------- */
async function kiemTra() {
    const btn = document.getElementById('btn');
    btn.disabled = true;
    btn.textContent = "Đang kiểm tra...";

    let parts = inputs.map(id => {
        let val = document.getElementById(id).value.trim();
        if (!/^\d{0,6}$/.test(val)) {
            alert("Mỗi phần chỉ được nhập tối đa 6 chữ số!");
            return null;
        }
        return val.padStart(6, '0');
    });
    if (parts.includes(null)) return;

    let fullStr = parts.join('').replace(/^0+/, '');
    if (fullStr === '') fullStr = '0';
    const n = BigInt(fullStr);
    const digits = fullStr.length;

    document.getElementById('result').innerHTML = `
        <p>Số cần kiểm tra: <strong>${n}</strong> (${digits} chữ số)</p>
        <div class="estimate">
            <strong>Thời gian xử lý ước tính:</strong> ${estimateTime(digits)}
        </div>
        <p>Đang kiểm tra (wheel 30 + lọc chính phương)...</p>
    `;

    await new Promise(r => setTimeout(r, 80));

    const t0 = performance.now();
    const divisor = trialDivisionWithDivisor(n);
    const t1 = performance.now();
    const timeTaken = ((t1 - t0) / 1000).toFixed(2);

    let html = '';
    if (divisor === null) {
        html = `<p class="prime">→ Là số nguyên tố</p>`;
    } else if (divisor === 0n) {
        html = `<p class="not-prime">→ Không phải số nguyên tố</p>`;
    } else {
        html = `
            <p class="not-prime">→ Không phải số nguyên tố</p>
            <p class="divisor">Chia hết cho: ${divisor}</p>
        `;
    }
    html += `<p>Thời gian thực tế: ${timeTaken} giây</p>`;
    document.getElementById('result').innerHTML += html;

    btn.disabled = false;
    btn.textContent = "Kiểm tra số nguyên tố";
}
</script>
</body>
<!-- Code được grok viết-->
</html>
